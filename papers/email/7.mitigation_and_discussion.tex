\section{Discussion and Mitigation}
We end by summarizing the root causes of the issues I discovered, and discuss potential mitigation strategies.

\subsection{Discussion}
In this work, I examine the complexities introduced by email forwarding to email security. We identify a diverse set of email forwarding mechanisms, assumptions, and features, and demonstrate how they can be combined together to perform evasion attacks. These attacks highlight four fundamental issues.

First, as already demonstrated in prior work and further highlighted in this chapter, email security involves distributed, optional, and independently-configured components implemented by different parties. In such an architecture, the
``authenticity'' of an email is commonly determined by the party with the weakest security settings. While traditionally email is sent directly from sender to receiver, forwarding involves three parties instead of two and introduces an extra layer of complexity. As I have shown, a vulnerable forwarder can jeopardize the security of downstream recipients that do not have problematic configurations or implementations. This inversion of
incentives and capabilities naturally complicates
mitigating forwarding vulnerabilities.

A second problem is that email forwarding has never been fully standardized, despite the longevity and popularity of its use. A lack of standardization has led to ad-hoc implementation decisions, each making different assumptions.
% Indeed, through our large-scale measurements, I identify a diverse set of email forwarding mechanisms, assumptions and features.
This ad-hoc nature of implementations makes it challenging to perform both manual security analysis (analyzing individual implementation decisions is a non-trivial task even for experts) and automated testing (any such tool needs to account for the specific implementations of each provider).
% reasoning about them challenging
% This is in addition to the challenge that there exists no universal dataset of all implementation choices.
% While our large-scale empirical measurements have
% addressed parts of this issue, 
While our large-scale empirical measurements have been able to reveal
the assumptions made by providers and their implications, it has
required substantial manual work.  This manual process is a reflection
of the fact that there exists no unified framework or standard for
implementing email forwarding.
% Any tool that seeks to automate the process needs to adapt to the specific implementations of each provider. In addition, it needs to handle a variety of other issues that are orthogonal to forwarding, such as automatic account creation, authentication, and bypassing anti-bot defenses. All these issues are research topics by themselves.


A third issue is that email is a large, slowly-evolving ecosystem with a wide range of legacy systems and protocols that need to be accommodated.
One example I highlight is the ``outdated'' assumption made by SPF (\S~\ref{subsubsec:spf_incorporation}). When SPF was first designed in the early 2000s, it was common practice for each domain owner to maintain their own mail infrastructure. However, this assumption is obsolete in the modern era, as many domains outsource their email services to third-party providers such as Outlook and Google~\cite{liu2021s}. These large providers often share the same email infrastructure across all customers (both business and personal accounts), violating the assumptions made by SPF. 
To mitigate the risks this reality poses to SPF, providers 
usually prevent users from setting arbitrary values in their FROM header. However, past literature has shown that this defense is not always implemented correctly~\cite{chen2020composition}. We build on top of this prior work by identifying a new attack that can circumvent existing defenses through forwarding (\S~\ref{subsec:attack_open_forwarding}).

Last but not least, the intrinsic nature of email forwarding is to transparently send an existing message to a new address ``on behalf'' of its original recipient --- a goal very much at odds with the anti-spoofing function of protocols such as SPF and DMARC. As such, a range of ad-hoc decisions have been made to increase the deliverability of forwarded email messages, such as using the REM+MOD forwarding mechanism (\S~\ref{sec:measure_forwarding_mechs_and_arc}), treating forwarded messages specially (\S~\ref{subsubsec:relaxed_validation}), and adding DKIM signatures to forwarded messages (\S~\ref{subsubsec:unsolicited_dkim}). As I have demonstrated, 
these decisions can fail to foresee unexpected interactions that lead to vulnerabilities, even with a lot of deliberation.

\subsection{Mitigation}
The attacks I demonstrate highlight the complicated interactions
between email forwarding and existing anti-spoofing mechanisms. We start by reviewing short-term mitigations that could reduce some of the most significant risks I have uncovered. We then discuss challenges in developing more comprehensive solutions, which would require significant changes in either
protocol or operational practices.

A core issue I highlight in this chapter is the ability to forward spoofed email messages to arbitrary recipients, a critical element in each
of the first three attacks in Section~\ref{sec:attacks}. To mitigate this issue, providers could either block spoofed email messages from being forwarded, or enforce that a forwarder can only forward to accounts under their control by requiring explicit confirmation (similar to
the online domain validation used by modern certificate authorities). However, I note that either approach comes with a usability tradeoff, and different providers make choices based on their considerations. Indeed, providers like Gmail and Mail.ru opted for the former option, while others like iCloud and Hushmail opted for the latter.



% allows users to forward spoofed email messages to arbitrary recipients, while Outlook blocks such forwarding~\cite{hotmailreject}.  We also note that while blocking spoofed email messages from being forwarded would protect downstream recipients, it would also break benign forwarding.  For example, a user forwarding a message from a friend to a colleague would be blocked by such a defense. 


% First, I recommend that all mail service providers disable \emph{open
%   forwarding}, and instead require explicit confirmation that the
% forwarding recipient is under the control of the forwarder (similar to
% the online domain validation used by modern certificate authorities). 
% This requirement would prevent the laundering that is a critical element in each
% of the first three attacks in Section~\ref{sec:attacks}.

% Next, a core assumption made by downstream providers is that upstream providers do not forward spoofed email messages. Blocking spoofed email messages from being forwarded is .

As well, I advocate that providers
should enforce a domain's DMARC \textsc{Reject} policy when specified, rather
than substituting a weaker policy.  If Outlook rejected spoofed
email messages from such domains, the impact of the first attack
exploiting SPF incorporation
would
narrow substantially. We understand that Outlook has plans to take such action in the future~\cite{hotmailreject}.


Unfortunately, all the defenses described above reflect a
case of misaligned
%harms
incentives: the recipients of spoofed email (\eg, spam and phishing)
cannot implement this change, but instead need to rely on the entire
ecosystem of providers and forwarding services to adopt such defenses. 

Email providers can also mitigate the second attack (\S~\ref{subsec:attack_relaxed_forwarding_validation}) by eliminating
relaxed validation policies.  This approach would protect their users
from receiving spoofed email without relying on changes by other
platforms or services.  However, to prevent benign forwarding from
breaking will likely require providers to then implement ARC
validation (which in turn places ARC implementation requirements on
external forwarders).

 % Finally, while relaxed validation certainly helps increase the
%deliverability of forwarded email messages, I recommend implementing
%ARC and stick with DMARC policy when possible.

For the final attack (\S~\ref{subsec:attack_none_mailing_list}) that exploits mailing lists, potential mitigations trade usability for security.
% As for the attack on mailing lists, there exists two types of defense mechanisms that trade usability for security.
First, list owners can turn on message moderation and set their mailing lists to be private.
While these measures increase the difficulty of performing email spoofing attacks, they do not rule out the attack entirely. A dedicated attacker might
nonetheless identify a member of the mailing list and craft an email
that fools a list's moderator.
Second, some mailing list services, such as Listserv, support confirm-before-send~\cite{OnmyLIST7:online}, which requests confirmation from the (true) sender address before delivery.  While this mechanism would impose significant overheads in general, these costs might be acceptable by limiting this confirmation requirement to incoming email that fails DMARC authentication checks.

In addition to the short-term mitigations mentioned above that are
specific to forwarding, others~\cite{chen2020composition,shen2020weak}
have proposed solutions such as improving UI notification, building
better testing tools, and revising RFC standards, which are also
important to consider. Additionally, the newly proposed ARC protocol
may also help mitigate some of the issues I have uncovered. However,
ARC is still in the early stages of development and deployment, 
its details are yet to be fleshed out and its effectiveness in
practice remains to be seen.
% \alex{and it may introduce other unexpected issues.} \grant{I think this last bit is a little speculative and there are enough caveats without it.}

Lastly, I note that comprehensively fixing email forwarding would
require a more fundamental set of changes (e.g., redesigning the
entire suite of email security protocols), which will face significant
deployment challenges given the current state of the email ecosystem.
Chief among these challenges is that any new solution designed to fix
forwarding must address backwards compatibility, a task complicated by
email's forty-year-old ecosystem of varied protocols, implementations
and use cases.  Specifically, one must carefully consider how any new
approach interacts and interoperates with existing systems (e.g., mail
providers and filtering service providers) and protocols (e.g., SPF,
DKIM and DMARC).  While security might be enhanced by embracing a
single standard approach to forwarding (e.g., when a message
should be forwarded, what forwarding mechanisms should be used, what
information should be added to forwarded messages, and how the
receiving account should be verified), any such choice will inevitably
  align well with certain providers and conflict with those whose
  existing services have made different choices or who operate under
  different threat models.  Finally, it is not enough to merely
  standardize new protocols, but one must then also incentivize and
  coordinate their universal deployment and operation.  Thus, while
  such an aspirational goal is worthy of attention, it seems likely
  that email will continue to benefit from incremental and reactive
  improvements, such as those discussed earlier, for some time yet.
